//     Backbone.js 0.5.3
//     (c) 2010 Jeremy Ashkenas, DocumentCloud Inc.
//     Backbone may be freely distributed under the MIT license.
//     For all details and documentation:
//     http://documentcloud.github.com/backbone
(function(a,b){if(typeof exports!=="undefined"){b(a,exports,require("underscore"))}else if(typeof define==="function"&&define.amd){define("backbone",["underscore","jquery","exports"],function(c,d,e){b(a,e,c,d)})}else{a.Backbone=b(a,{},a._,a.jQuery||a.Zepto||a.ender)}})(this,function(a,b,c,d){var e=a.Backbone;var f=Array.prototype.slice;b.VERSION="0.5.3";b.noConflict=function(){a.Backbone=e;return b};b.emulateHTTP=false;b.emulateJSON=false;b.Events={bind:function(a,b,c){var d=this._callbacks||(this._callbacks={});var e=d[a]||(d[a]={});var f=e.tail||(e.tail=e.next={});f.callback=b;f.context=c;e.tail=f.next={};return this},unbind:function(a,b){var c,d,e;if(!a){this._callbacks=null}else if(c=this._callbacks){if(!b){c[a]={}}else if(d=c[a]){while((e=d)&&(d=d.next)){if(d.callback!==b)continue;e.next=d.next;d.context=d.callback=null;break}}}return this},trigger:function(a){var b,c,d,e,g,h=["all",a];if(!(c=this._callbacks))return this;while(g=h.pop()){if(!(b=c[g]))continue;e=g=="all"?arguments:f.call(arguments,1);while(b=b.next)if(d=b.callback)d.apply(b.context||this,e)}return this}};b.Model=function(a,b){var d;a||(a={});if(d=this.defaults){if(c.isFunction(d))d=d.call(this);a=c.extend({},d,a)}this.attributes={};this._escapedAttributes={};this.cid=c.uniqueId("c");this.set(a,{silent:true});this._changed=false;this._previousAttributes=c.clone(this.attributes);if(b&&b.collection)this.collection=b.collection;this.initialize(a,b)};c.extend(b.Model.prototype,b.Events,{_changed:false,idAttribute:"id",initialize:function(){},toJSON:function(){return c.clone(this.attributes)},get:function(a){return this.attributes[a]},escape:function(a){var b;if(b=this._escapedAttributes[a])return b;var d=this.attributes[a];return this._escapedAttributes[a]=c.escape(d==null?"":""+d)},has:function(a){return this.attributes[a]!=null},set:function(a,b){b||(b={});if(!a)return this;if(a.attributes)a=a.attributes;var d=this.attributes,e=this._escapedAttributes;if(!b.silent&&this.validate&&!this._performValidation(a,b))return false;if(this.idAttribute in a)this.id=a[this.idAttribute];var f=this._changing;this._changing=true;for(var g in a){var h=a[g];if(!c.isEqual(d[g],h)){d[g]=h;delete e[g];this._changed=true;if(!b.silent)this.trigger("change:"+g,this,h,b)}}if(!f){if(!b.silent&&this._changed)this.change(b);this._changing=false}return this},unset:function(a,b){if(!(a in this.attributes))return this;b||(b={});var c=this.attributes[a];var d={};d[a]=void 0;if(!b.silent&&this.validate&&!this._performValidation(d,b))return false;(this._unsetAttributes||(this._unsetAttributes=[])).push(a);delete this.attributes[a];delete this._escapedAttributes[a];if(a==this.idAttribute)delete this.id;this._changed=true;if(!b.silent){this.trigger("change:"+a,this,void 0,b);this.change(b)}return this},clear:function(a){a||(a={});var b;var c=this.attributes;var d={};for(b in c)d[b]=void 0;if(!a.silent&&this.validate&&!this._performValidation(d,a))return false;this.attributes={};this._escapedAttributes={};this._changed=true;if(!a.silent){for(b in c){this.trigger("change:"+b,this,void 0,a)}this.change(a)}return this},fetch:function(a){a||(a={});var c=this;var d=a.success;a.success=function(b,e,f){if(!c.set(c.parse(b,f),a))return false;if(d)d(c,b)};a.error=w(a.error,c,a);return(this.sync||b.sync).call(this,"read",this,a)},save:function(a,c){c||(c={});if(a&&!this.set(a,c))return false;var d=this;var e=c.success;c.success=function(a,b,f){if(!d.set(d.parse(a,f),c))return false;if(e)e(d,a,f)};c.error=w(c.error,d,c);var f=this.isNew()?"create":"update";return(this.sync||b.sync).call(this,f,this,c)},destroy:function(a){a||(a={});if(this.isNew())return this.trigger("destroy",this,this.collection,a);var c=this;var d=a.success;a.success=function(b){c.trigger("destroy",c,c.collection,a);if(d)d(c,b)};a.error=w(a.error,c,a);return(this.sync||b.sync).call(this,"delete",this,a)},url:function(){var a=u(this.collection)||this.urlRoot||v();if(this.isNew())return a;return a+(a.charAt(a.length-1)=="/"?"":"/")+encodeURIComponent(this.id)},parse:function(a,b){return a},clone:function(){return new this.constructor(this)},isNew:function(){return this.id==null},change:function(a){this.trigger("change",this,a);this._previousAttributes=c.clone(this.attributes);this._unsetAttributes=null;this._changed=false},hasChanged:function(a){if(a)return this._previousAttributes[a]!=this.attributes[a];return this._changed},changedAttributes:function(a){a||(a=this.attributes);var b=this._previousAttributes,d=this._unsetAttributes;var e=false;for(var f in a){if(!c.isEqual(b[f],a[f])){e||(e={});e[f]=a[f]}}if(d){e||(e={});var g=d.length;while(g--)e[d[g]]=void 0}return e},previous:function(a){if(!a||!this._previousAttributes)return null;return this._previousAttributes[a]},previousAttributes:function(){return c.clone(this._previousAttributes)},_performValidation:function(a,b){var c=this.validate(a);if(c){if(b.error){b.error(this,c,b)}else{this.trigger("error",this,c,b)}return false}return true}});b.Collection=function(a,b){b||(b={});if(b.comparator)this.comparator=b.comparator;c.bindAll(this,"_onModelEvent","_removeReference");this._reset();if(a)this.reset(a,{silent:true});this.initialize.apply(this,arguments)};c.extend(b.Collection.prototype,b.Events,{model:b.Model,initialize:function(){},toJSON:function(){return this.map(function(a){return a.toJSON()})},add:function(a,b){if(c.isArray(a)){for(var d=0,e=a.length;d<e;d++){this._add(a[d],b)}}else{this._add(a,b)}return this},remove:function(a,b){if(c.isArray(a)){for(var d=0,e=a.length;d<e;d++){this._remove(a[d],b)}}else{this._remove(a,b)}return this},get:function(a){if(a==null)return null;return this._byId[a.id!=null?a.id:a]},getByCid:function(a){return a&&this._byCid[a.cid||a]},at:function(a){return this.models[a]},sort:function(a){a||(a={});if(!this.comparator)throw new Error("Cannot sort a set without a comparator");this.models=this.sortBy(this.comparator);if(!a.silent)this.trigger("reset",this,a);return this},pluck:function(a){return c.map(this.models,function(b){return b.get(a)})},reset:function(a,b){a||(a=[]);b||(b={});this.each(this._removeReference);this._reset();this.add(a,{silent:true});if(!b.silent)this.trigger("reset",this,b);return this},fetch:function(a){a||(a={});var c=this;var d=a.success;a.success=function(b,e,f){c[a.add?"add":"reset"](c.parse(b,f),a);if(d)d(c,b)};a.error=w(a.error,c,a);return(this.sync||b.sync).call(this,"read",this,a)},create:function(a,b){var c=this;b||(b={});a=this._prepareModel(a,b);if(!a)return false;var d=b.success;b.success=function(a,e,f){c.add(a,b);if(d)d(a,e,f)};a.save(null,b);return a},parse:function(a,b){return a},chain:function(){return c(this.models).chain()},_reset:function(a){this.length=0;this.models=[];this._byId={};this._byCid={}},_prepareModel:function(a,c){if(!(a instanceof b.Model)){var d=a;a=new this.model(d,{collection:this});if(a.validate&&!a._performValidation(a.attributes,c))a=false}else if(!a.collection){a.collection=this}return a},_add:function(a,b){b||(b={});a=this._prepareModel(a,b);if(!a)return false;var c=this.getByCid(a);if(c)throw new Error(["Can't add the same model to a set twice",c.id]);this._byId[a.id]=a;this._byCid[a.cid]=a;var d=b.at!=null?b.at:this.comparator?this.sortedIndex(a,this.comparator):this.length;this.models.splice(d,0,a);a.bind("all",this._onModelEvent);this.length++;b.index=d;if(!b.silent)a.trigger("add",a,this,b);return a},_remove:function(a,b){b||(b={});a=this.getByCid(a)||this.get(a);if(!a)return null;delete this._byId[a.id];delete this._byCid[a.cid];var c=this.indexOf(a);this.models.splice(c,1);this.length--;b.index=c;if(!b.silent)a.trigger("remove",a,this,b);this._removeReference(a);return a},_removeReference:function(a){if(this==a.collection){delete a.collection}a.unbind("all",this._onModelEvent)},_onModelEvent:function(a,b,c,d){if((a=="add"||a=="remove")&&c!=this)return;if(a=="destroy"){this._remove(b,d)}if(b&&a==="change:"+b.idAttribute){delete this._byId[b.previous(b.idAttribute)];this._byId[b.id]=b}this.trigger.apply(this,arguments)}});var g=["forEach","each","map","reduce","reduceRight","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","sortBy","sortedIndex","toArray","size","first","rest","last","without","indexOf","lastIndexOf","isEmpty","groupBy"];c.each(g,function(a){b.Collection.prototype[a]=function(){return c[a].apply(c,[this.models].concat(c.toArray(arguments)))}});b.Router=function(a){a||(a={});if(a.routes)this.routes=a.routes;this._bindRoutes();this.initialize.apply(this,arguments)};var h=/:([\w\d]+)/g;var i=/\*([\w\d]+)/g;var j=/[-[\]{}()+?.,\\^$|#\s]/g;c.extend(b.Router.prototype,b.Events,{initialize:function(){},route:function(a,d,e){b.history||(b.history=new b.History);if(!c.isRegExp(a))a=this._routeToRegExp(a);b.history.route(a,c.bind(function(b){var c=this._extractParameters(a,b);e&&e.apply(this,c);this.trigger.apply(this,["route:"+d].concat(c))},this))},navigate:function(a,c){b.history.navigate(a,c)},_bindRoutes:function(){if(!this.routes)return;var a=[];for(var b in this.routes){a.unshift([b,this.routes[b]])}for(var c=0,d=a.length;c<d;c++){this.route(a[c][0],a[c][1],this[a[c][1]])}},_routeToRegExp:function(a){a=a.replace(j,"\\$&").replace(h,"([^/]*)").replace(i,"(.*?)");return new RegExp("^"+a+"$")},_extractParameters:function(a,b){return a.exec(b).slice(1)}});b.History=function(){this.handlers=[];c.bindAll(this,"checkUrl")};var k=/^#*/;var l=/msie [\w.]+/;var m=false;c.extend(b.History.prototype,{interval:50,getFragment:function(a,b){if(a==null){if(this._hasPushState||b){a=window.location.pathname;var c=window.location.search;if(c)a+=c}else{a=window.location.hash}}a=decodeURIComponent(a.replace(k,""));if(!a.indexOf(this.options.root))a=a.substr(this.options.root.length);return a},start:function(a){if(m)throw new Error("Backbone.history has already been started");this.options=c.extend({},{root:"/"},this.options,a);this._wantsPushState=!!this.options.pushState;this._hasPushState=!!(this.options.pushState&&window.history&&window.history.pushState);var b=this.getFragment();var e=document.documentMode;var f=l.exec(navigator.userAgent.toLowerCase())&&(!e||e<=7);if(f){this.iframe=d('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow;this.navigate(b)}if(this._hasPushState){d(window).bind("popstate",this.checkUrl)}else if("onhashchange"in window&&!f){d(window).bind("hashchange",this.checkUrl)}else{setInterval(this.checkUrl,this.interval)}this.fragment=b;m=true;var g=window.location;var h=g.pathname==this.options.root;if(this._wantsPushState&&!this._hasPushState&&!h){this.fragment=this.getFragment(null,true);window.location.replace(this.options.root+"#"+this.fragment);return true}else if(this._wantsPushState&&this._hasPushState&&h&&g.hash){this.fragment=g.hash.replace(k,"");window.history.replaceState({},document.title,g.protocol+"//"+g.host+this.options.root+this.fragment)}if(!this.options.silent){return this.loadUrl()}},route:function(a,b){this.handlers.unshift({route:a,callback:b})},checkUrl:function(a){var b=this.getFragment();if(b==this.fragment&&this.iframe)b=this.getFragment(this.iframe.location.hash);if(b==this.fragment||b==decodeURIComponent(this.fragment))return false;if(this.iframe)this.navigate(b);this.loadUrl()||this.loadUrl(window.location.hash)},loadUrl:function(a){var b=this.fragment=this.getFragment(a);var d=c.any(this.handlers,function(a){if(a.route.test(b)){a.callback(b);return true}});return d},navigate:function(a,b){var c=(a||"").replace(k,"");if(this.fragment==c||this.fragment==decodeURIComponent(c))return;if(this._hasPushState){var d=window.location;if(c.indexOf(this.options.root)!=0)c=this.options.root+c;this.fragment=c;window.history.pushState({},document.title,d.protocol+"//"+d.host+c)}else{window.location.hash=this.fragment=c;if(this.iframe&&c!=this.getFragment(this.iframe.location.hash)){this.iframe.document.open().close();this.iframe.location.hash=c}}if(b)this.loadUrl(a)}});b.View=function(a){this.cid=c.uniqueId("view");this._configure(a||{});this._ensureElement();this.delegateEvents();this.initialize.apply(this,arguments)};var n=function(a){return d(a,this.el)};var o=/^(\S+)\s*(.*)$/;var p=["model","collection","el","id","attributes","className","tagName"];c.extend(b.View.prototype,b.Events,{tagName:"div",$:n,initialize:function(){},render:function(){return this},remove:function(){d(this.el).remove();return this},make:function(a,b,c){var e=document.createElement(a);if(b)d(e).attr(b);if(c)d(e).html(c);return e},delegateEvents:function(a){if(!(a||(a=this.events)))return;if(c.isFunction(a))a=a.call(this);this.undelegateEvents();for(var b in a){var e=this[a[b]];if(!e)throw new Error('Event "'+a[b]+'" does not exist');var f=b.match(o);var g=f[1],h=f[2];e=c.bind(e,this);g+=".delegateEvents"+this.cid;if(h===""){d(this.el).bind(g,e)}else{d(this.el).delegate(h,g,e)}}},undelegateEvents:function(){d(this.el).unbind(".delegateEvents"+this.cid)},_configure:function(a){if(this.options)a=c.extend({},this.options,a);for(var b=0,d=p.length;b<d;b++){var e=p[b];if(a[e])this[e]=a[e]}this.options=a},_ensureElement:function(){if(!this.el){var a=this.attributes||{};if(this.id)a.id=this.id;if(this.className)a["class"]=this.className;this.el=this.make(this.tagName,a)}else if(c.isString(this.el)){this.el=d(this.el).get(0)}}});var q=function(a,b){var c=t(this,a,b);c.extend=this.extend;return c};b.Model.extend=b.Collection.extend=b.Router.extend=b.View.extend=q;var r={create:"POST",update:"PUT","delete":"DELETE",read:"GET"};b.sync=function(a,e,f){var g=r[a];var h={type:g,dataType:"json"};if(!f.url){h.url=u(e)||v()}if(!f.data&&e&&(a=="create"||a=="update")){h.contentType="application/json";h.data=JSON.stringify(e.toJSON())}if(b.emulateJSON){h.contentType="application/x-www-form-urlencoded";h.data=h.data?{model:h.data}:{}}if(b.emulateHTTP){if(g==="PUT"||g==="DELETE"){if(b.emulateJSON)h.data._method=g;h.type="POST";h.beforeSend=function(a){a.setRequestHeader("X-HTTP-Method-Override",g)}}}if(h.type!=="GET"&&!b.emulateJSON){h.processData=false}return d.ajax(c.extend(h,f))};var s=function(){};var t=function(a,b,d){var e;if(b&&b.hasOwnProperty("constructor")){e=b.constructor}else{e=function(){return a.apply(this,arguments)}}c.extend(e,a);s.prototype=a.prototype;e.prototype=new s;if(b)c.extend(e.prototype,b);if(d)c.extend(e,d);e.prototype.constructor=e;e.__super__=a.prototype;return e};var u=function(a){if(!(a&&a.url))return null;return c.isFunction(a.url)?a.url():a.url};var v=function(){throw new Error('A "url" property or function must be specified')};var w=function(a,b,c){return function(d,e){var e=d===b?e:d;if(a){a(d,e,c)}else{b.trigger("error",d,e,c)}}};return b})