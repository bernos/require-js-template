/* piewpiew-backbone library v0.0.1 */
define(["underscore","backbone"],function(a,b){var c={},d=!1;return c.Class=function(){var b=null,e=null,f=function(){d||this.initialize.apply(this,arguments)};return typeof arguments[0]=="function"?(e=arguments[0],b=arguments[1]):b=arguments[0],e&&(d=!0,f.prototype=new e,d=!1),a.extend(f.prototype,b),f.prototype.constructor=f,f.prototype.initialize||(f.prototype.initialize=function(){}),f.extend=function(a){return c.Class(this,a)},f},c.View=b.View.extend({template:"No template specified for view",templateFunction:function(a,b){return c.View.template(a,b)},templateContext:function(){return this.model&&typeof this.model.toJSON=="function"?this.model.toJSON():{}},render:function(){return $(this.el).html(this.templateFunction(this.template,this.templateContext())),this},onRegister:function(a){return this}}),c.View.template=function(b,c){return a.template(b,c)},c.Facade=b.View.extend({initialize:function(b,d){if(c.Facade.instanceMap[b])throw"Facade instance with key '"+b+"' already exists.";return c.Facade.instanceMap[b]=this,a.extend(this,d||{}),this._multitonKey=b,this._routerMap={},this._modelMap={},this._viewMap={},this.initializeRouter(),this.initializeModel(),this.initializeView(),this.initializeController(),this},intitializeRouter:function(){return this},initializeModel:function(){return this},initializeView:function(){return this},initializeController:function(){return this},registerRouter:function(a,b){this._routerMap[a]=b},getRouter:function(a){return this._routerMap[a]},registerModel:function(a,b){return this._modelMap[a]=b,b.facade=this,typeof b.onRegister=="function"&&b.onRegister(this),this},getModel:function(a){return this._modelMap[a]},registerView:function(a,b){return this._viewMap[a]=b,b.facade=this,typeof b.onRegister=="function"&&b.onRegister(this),this},getView:function(a){return this._viewMap[a]},registerCommand:function(a,b,c){var d=this;return b.bind(c,function(){var b=new a(d);b.execute.apply(b,arguments)}),this}}),c.Facade.instanceMap={},c.SimpleCommand=c.Class({initialize:function(a){this.facade=a},execute:function(){return this}}),c.MacroCommand=c.Class({initialize:function(a){this.facade=a,this.subCommands=[],this.initializeMacroCommand()},initializeMacroCommand:function(){return this},addSubCommand:function(a){return this.subCommands.push(a),this},execute:function(){while(this.subCommands.length>0){var a=this.subCommands.shift(),b=new a(this.facade);b.execute.apply(b,arguments)}return this}}),c});